Alphabet

   פ¨° פ¨± פ¨² פ¨³ פ¨´ פ¨µ פ¨¡ פ¨¶ פ¨· פ¨¸ פ¨¹ פ¨÷ פ¨» פ¨¼ פ¨½ פ¨¾ פ×ָ פ¨¿ פ¨ְ פ¨ֱ פ¨ֲ פ¨ֳ פ©מ פ¨ִ פ¨ֵ פ¨ֶ פ¨ַ פ¨ָ פ¨ֹ פ¨ פ¨ֻ פ¨ּ פ¨ֽ פ¨־ פ¨ֿ פ©ת פ©ה פ©װ
   פ¨׀ פ¨ׁ פ¨ׂ פ¨׃ פ¨װ פ¨ױ פ¨ס פ¨ײ פ¨׳ פ¨״ פ¨ פ¨ פ¨ פ¨ פ¨ פ¨ פ×ֹ פ¨ פ¨א פ¨ב פ¨ג פ¨ד פ©ן פ¨ה פ¨ו פ¨ז פ¨ח פ¨ט פ¨י פ¨ך פ¨כ פ¨ל פ¨ם פ¨מ פ¨ן פ© פ©ו פ©ױ

   !%{E%}:פ¨׀ %{E%}:פ¨ם %{E%}:פ×ֹ %{E%}:פ¨

   !%{A%}:פ¨׀ %{A%}:פ¨ם %{A%}:פ×ֹ %{A%}:פ¨
   %{A%}:פ¨׀
   !%{I%}:פ¨״ %{I%}:פ¨ד %{I%}:פ©ן %{I%}:פ¨כ
   %{I%}:פ¨כ

   %{L%}:פ¨ ! %{L%}:פ¨ג %{L%}:פ¨װ %{L%}:פ¨
   %{T%}:פ¨ג ! %{T%}:פ¨װ %{T%}:פ¨ %{T%}:פ¨

   %{B%}:פ¨ׁ ! %{B%}:פ¨ %{B%}:פ¨

   %{G%}:פ¨׃ ! %{G%}:פ¨ %{G%}:פ©ױ %{G%}:פ¨ו %{G%}:פ©ו

   %{i%}:0 ! %{i%}:פ¨״ %{i%}:פ¨ד %{i%}:פ©ן %{i%}:פ¨כ

   %{y%}:0 ! %{y%}:פ¨״ %{y%}:פ¨ד %{y%}:פ©ן %{y%}:פ¨כ

   %{n%}:0 ! %{n%}:פ¨

   %{t%}:0 ! %{t%}:פ¨ג

   %{a%}:0

   %{פ¨א%}:פ¨א

   %{ע£­%}:0
   %{פ¨ך%}:0

   %>:0 ; 


Sets

Vow = פ¨ֿ פ¨־ פ¨¡ פ¨° פ¨¾ פ¨ֻ פ¨ֳ פ¨ֽ פ¨µ פ¨¸ פ×ָ פ©מ
      פ¨ן פ¨מ פ¨ס פ¨׀ פ¨ פ¨כ פ¨ד פ¨ם פ¨ױ פ¨״ פ×ֹ פ©ן ;

RealVow = פ¨° פ¨¾ פ¨ֻ פ¨ֳ פ¨ֽ פ¨¸ פ×ָ פ©מ
          פ¨׀ פ¨ פ¨כ פ¨ד פ¨ם פ¨״ פ×ֹ פ©ן ;

LowVow = פ¨ֿ פ¨¡ פ¨° פ¨¾ פ¨ֽ פ¨µ פ×ָ
         פ¨ן פ¨ס פ¨׀ פ¨ פ¨ם פ¨ױ פ×ֹ ;

HighVow = פ¨־ פ¨ֻ פ¨ֳ פ¨¸ פ©מ
          פ¨מ פ¨כ פ¨ד פ¨״ פ©ן ;

Nasal = פ¨¼ פ¨½ פ©ה
        פ¨ פ¨ פ©ו ;

HighSonCns = פ¨¹ פ¨ְ
             פ¨ פ¨א ;

VoicelessCns = פ¨¿ פ¨´ פ¨ֲ פ¨÷ פ¨ֵ פ¨ֱ פ¨· פ¨¶ פ¨²
               פ¨ פ¨װ פ¨ג פ¨ פ¨ו פ¨ב פ¨׳ פ¨ײ פ¨ׂ ;

Obs = פ¨± פ¨² פ¨³ פ¨´ פ¨¶ פ¨· פ¨÷ פ¨¿ פ¨ְ פ¨ֱ פ¨ֲ פ¨ִ פ¨ֵ פ¨ֶ פ¨ַ פ¨ָ פ¨ֹ פ©ת פ©װ
      פ¨ׁ פ¨ׂ פ¨׃ פ¨װ פ¨ײ פ¨׳ פ¨ פ¨ פ¨א פ¨ב פ¨ג פ¨ה פ¨ו פ¨ז פ¨ח פ¨ט פ¨י פ© פ©ױ ;

Cons = פ¨± פ¨² פ¨³ פ¨´ פ¨¶ פ¨· פ¨¹ פ¨÷ פ¨» פ¨¼ פ¨½ פ¨¿ פ¨ְ פ¨ֱ פ¨ֲ פ¨ִ פ¨ֵ פ¨ֶ פ¨ַ פ¨ָ פ¨ֹ פ©ת פ©ה פ©װ
       פ¨ׁ פ¨ׂ פ¨׃ פ¨װ פ¨ײ פ¨׳ פ¨ פ¨ פ¨ פ¨ פ¨ פ¨ פ¨א פ¨ב פ¨ג פ¨ה פ¨ו פ¨ז פ¨ח פ¨ט פ¨י פ© פ©ו פ©ױ ;


Rules

!"Vowel deletion"
!%{A%}:0 <=> _ %>: %{I%}: ; 


!!!== regressive assimilation ==!!!

"פ¨ג assimilation"
פ¨ג:Cy <=> _ %>: Cx: ;
     except
         [ :פ¨ | :פ¨ב | :פ¨ ] _ %>:/[ :0 - %>: ] ;
     where Cx in ( %{B%} %{G%} ) ! %{L%} ) 
           Cy in (   פ¨     פ¨   ) !  פ¨ג ) 
     matched ;  

"{פ¨א} פצע פ¨ before פ¨"
%{פ¨א%}:פ¨ <=> _ [ :פ¨ | [ %{L%}: - :Obs ] ]/:0 ;


! FIXME: These two rules should probably be generalised
"פ¨פצעפ©ו assimilation"
פ¨:פ©ו <=> _ :פ©ו/:0 ; 

"פ¨פצעפ¨ assimilation"
פ¨:פ¨ <=> _ %>: %{B%}: ; 

!!!== progressive assimilation ==!!!

"Assimilation after nasals"
Cx:Cy <=> :Nasal [ :0 - פ¨ג: ]* _ ;
      where Cx in ( %{L%} %{T%} %{G%} %{B%} )
            Cy in (   פ¨     פ¨     פ©ו     פ¨   )
      matched ;

"Assimilation after high-sonority obstruents"
Cx:Cy <=> :HighSonCns/:0 _ ;
      where Cx in ( %{L%} %{T%} )
            Cy in (   פ¨װ     פ¨װ   )
      matched ;

"Assimilation after voiceless consonants"
Cx:Cy <=> :VoicelessCns/:0 _ ;
      where Cx in ( %{L%} %{B%} )
            Cy in (   פ¨ג     פ¨   )
      matched ;

"{T} פצע פ¨"
%{T%}:פ¨ <=> :פ¨/:0 _ ; 

"{G} after פ¨ו"
%{G%}:פ¨ו <=> :פ¨ו/:0 _ ;

"{G} after voiceless consonants besides פ¨ו"
%{G%}:פ¨ <=> [ :VoicelessCns - :פ¨ו]/:0 _ ;


!!!== deletion ==!!!

"{פ¨א} deletes before obstruents or something"
%{פ¨א%}:0 <=> _ :Obs/:0 ;


!!!== epenthesis ==!!!

"פ¨ג after a vowel"
%{t%}:פ¨ג <=> :Vow/:0 _ ;

"פ¨ after a vowel"
%{n%}:פ¨ <=> :Vow/:0 _ ;
            !@ פ¨״ פ¨װ פ¨ױ פ¨ן >:0 {n}:פ¨ {I}:פ¨כ


!!!== lenition ==!!!

"intervocalic lenition"
Cx:Cy <=> :Vow/:0* _ [ %>: :Vow]/[ :0 - %>: ]* ;
             !@ פ¨״ פ¨ב:פ© {y}:פ¨״ פ¨ג
          ! :Vow/:0* _ :0* %>: :0* :Vow ;
          !    !פ¨ױ פ¨:__ פ¨ג:0 {ע£­}:0 >:0 {t}:0 {A}:פ¨׀
          :Vow _ %{y%}:Vow ; 
      where Cx in ( פ¨ו פ¨ב פ¨ פ¨ )
            Cy in ( פ©ױ פ© פ¨׃ פ¨ׁ )
      matched ;


"{G} after low vowel"
%{G%}:פ©ױ <=> :LowVow/:0 _ ;
            !@ פ¨µ פ¨ׂ פ¨א פ¨ פ¨ פ¨׀ >:0 {G}:פ©ױ {A}:פ¨׀


!!!== Vowel Harmony ==!!!

"vowel harmony for {i}"
%{i%}:Vy <=> :Vx [ :Cons* :Cons ]/:0* _ ;
         except 
             _ %>: %{A%}: ; ! because {i}:0 >:0 {A}: 
                !@ פ¨ם:פ¨ם {T}:פ¨ג {i}:0 >:0 {A}:פ¨ם
         where Vx in ( פ¨׀ פ¨ פ¨כ פ¨ד פ¨ם פ¨ױ פ¨״ פ×ֹ פ©ן פ¨ן )
               Vy in ( פ¨כ פ¨ד פ¨כ פ¨ד פ¨״ פ¨״ פ¨״ פ©ן פ©ן פ¨כ )
         matched ;



"vowel harmony for {y}"
%{y%}:Vy <=> :Vx [ :Cons* :Cons ]/:0* _ ;
         except 
             _ [ :Cons :Vow ]/:0* ;
             !@ פ¨״פ¨ב{y}פ¨ג
         where Vx in ( פ¨׀ פ¨ פ¨כ פ¨ד פ¨ם פ¨ױ פ¨״ פ×ֹ פ©ן פ¨ן )
               Vy in ( פ¨כ פ¨ד פ¨כ פ¨ד פ¨״ פ¨״ פ¨״ פ©ן פ©ן פ¨כ )
         matched ;


"vowel harmony for {I}"
%{I%}:Vy <=> :Vx [ :Cons* :Cons ]/[ :0 - %{ע£­%}: ]* _ ;
             %{I%}:Vx _ ;
         except
         !    ! [ %{פ¨ך%}: | %{ע£­%}: ]  %>: [ :Cons* ]/:0* _ ;
         !    %{ע£­%}: [ :Cons* :Cons ]/:0* _ ;
         where Vx in ( פ¨׀ פ¨ פ¨כ פ¨ד פ¨ם פ¨ױ פ¨״ פ×ֹ פ©ן פ¨ן )
               Vy in ( פ¨כ פ¨ד פ¨כ פ¨ד פ¨״ פ¨״ פ¨״ פ©ן פ©ן פ¨כ )
         matched ;


!!FIXME! פ¨ה פ¨׀ פ¨ פ¨ד פ¨ פ¨ל פ¨ג פ¨ױ פ¨ג {ע£­}:0 >:0 {n}: {I}:

!@ פ¨ׁ פ¨ד פ¨ פ¨ >:0 {I}:פ¨ד {A}:פ¨׀ פ¨ו >:0 פ¨ג {A}:פ¨׀ {A}:פ¨׀ פ¨ו

"vowel harmony for {A} except after פ¨דפ¨ and פ©ןפ×ֹ"
%{A%}:Vy <=> :Vx [ :Cons* :Cons ]/[ :0 - %{ע£­%}: ]* _ ;
             ! :Cons :Vx _ ;  ! FIXME: When does this happen?
             %{A%}:Vx _ ;
         except
             :פ©ן :פ×ֹ [ :Cons* :Cons]/:0* _ ;
             :פ¨ד :פ¨ [ :Cons* :Cons]/:0* _ ;
             ! :Vow :Vow %>: _ ; 
             !    ! for verb stems ending in long vowel or diphthong
             !%{פ¨ך%}: %>: [ :Cons* ]/:0* _ ; 
             %{ע£­%}: [ :Cons* :Cons ]/:0* _ ;
         where Vx in ( פ¨׀ פ¨ פ¨כ פ¨ד פ¨ם פ¨ױ פ¨״ פ×ֹ פ©ן פ¨ן )
               Vy in ( פ¨׀ פ¨ פ¨׀ פ¨׀ פ¨ם פ¨ם פ¨ם פ×ֹ פ¨ם פ¨׀ )
         matched ;

"{A} as part of {I}{A}"
%{A%}:Vy <=> %{I%}:Vx _ ;
         except
             :RealVow :RealVow %>: %{I%}:Vx _ ;
         where Vx in ( פ¨״ פ©ן פ¨כ פ¨ד )
               Vy in ( פ¨ם פ×ֹ פ¨׀ פ¨ )
         matched ;

"{A} deletes after long vowels and diphthongs and triggers other stuff (and as part of {I}{A})"
%{A%}:0 <=> :RealVow :RealVow %>: (%{I%}:) _ ;

"{I} deletes after long vowels and diphthongs and triggers other stuff"
%{I%}:0 <=> :RealVow :RealVow %>: _ ;

"first element of diphthongs and long vowels immediately before ({I}){A}"
Vx:Vy <=> _ :RealVow %>: (%{I%}:) %{A%}: ;
      where Vx in ( פ¨׀ פ¨ פ¨ם פ×ֹ )
            Vy in ( פ¨כ פ¨ד פ¨״ פ©ן )
      matched ;

!"first element of diphthongs and long vowels immediately before {I}{A}"
!Vx:Vy <=> _ :RealVow %>: %{I%}: %{A%}: ;
!      where Vx in ( פ¨ם פ¨׀ פ¨ פ×ֹ )
!            Vy in ( פ¨״ פ¨כ פ¨ד פ©ן )
!      matched ;

"second element of diphthongs and long vowels immediately before {A}"
Vx:Vy <=> :RealVow _ %>: %{A%}: ;
      where Vx in ( פ¨׀ פ¨ פ¨ם פ×ֹ )
            Vy in ( פ¨כ פ¨ד פ¨״ פ©ן )
      matched ;

"vowel harmony for {a} except after פ¨דפ¨ and פ©ןפ×ֹ"
%{a%}:Vy <=> :Vx [ :Cons* :Cons ]/:0* _ ;
         except
             :פ©ן :פ×ֹ [ :Cons* :Cons]/:0* _ ;
             :פ¨ד :פ¨ [ :Cons* :Cons]/:0* _ ;
         where Vx in ( פ¨׀ פ¨ פ¨כ פ¨ד פ¨ם פ¨ױ פ¨״ פ×ֹ פ©ן פ¨ן )
               Vy in ( פ¨׀ פ¨ פ¨׀ פ¨׀ פ¨ם פ¨ם פ¨ם פ×ֹ פ¨ם פ¨׀ )
         matched ;

"vowel harmony for {a} after פ©ןפ×ֹ"
%{a%}:פ¨ם <=> :פ©ן :פ×ֹ [ :Cons* :Cons ]/:0* _ ;

!FIXME 
"vowel harmony for {I} after back harmony marker"
%{I%}:פ¨כ <=> :Vow [ :Cons* :Cons ]/:0* _ ;
            ! [ %{פ¨ך%}: | %{ע£­%}: ] %>: [ :Cons* ]/:0* _ ;            
        except
            :Vow [ :Cons* :Cons ]/[ :0 - %{ע£­%}: ]* _ ;



!!!== Defaults that shouldn't be necessary ==!!!

"{G} after high vowel"
%{G%}:פ¨׃ <=> :HighVow/:0 _ ;
            :HighSonCns/:0 _ ;
            :פ¨/:0 _ ;  

!@ פ¨ב פ¨כ פ¨ >:0 {G}:פ¨׃ {A}:פ¨׀

"vowel harmony for {A} after פ¨דפ¨ etc."
! shouldn't need a rule because it's the default פ¨׀, but doesn't seem to work without one
%{A%}:פ¨׀ <=> :פ¨ד :פ¨ [ :Cons* :Cons ]/:0* _ ;
            ! %{פ¨ך%}: %>: [ :Cons* ]/:0* _ ;            
            :Vow [ :Cons* :Cons %{ע£­%}: ]/[ :0 - %{ע£­%}: ]* _ ;
            :Vow [ :Cons* %{ע£­%}: :Cons ]/[ :0 - %{ע£­%}: ]* _ ;
            :Vow [ %{ע£­%}: :Cons* :Cons ]/[ :0 - %{ע£­%}: ]* _ ;
            ! :Cons/[ :0 - %{ע£­%}: ] %{ע£­%}: _ ;
            ! %{ע£­%}: :Cons/[ :0 - %{ע£­%}: ] _ ;
            ! :Vow %{ע£­%}: [ :Cons* :Cons ]/[ :0 - %{ע£­%}: ]* _ ;
               !פ¨פ¨פ¨פ¨פ¨לפ¨מפ¨גפ¨ױפ¨א{פ¨ך}>{L}{A}פ¨א
               !@ פ¨´ פ¨ל פ¨ פ¨ פ¨ד פ¨ד פ¨ב פ¨ פ¨׀ פ¨ >:0 {T}:פ¨װ {A}:פ¨׀ {A}:פ¨׀ פ©ױ {I}:פ¨כ
            ! :Vow [ :Cons* :Cons ]/[ :0 - %{ע£­%}: ]* %{ע£­%}: _ ;
            ! :Vow [ :Cons* %{ע£­%}: :Cons ]/[ :0 - %{ע£­%}: ]* _ ;
        except
            :פ©ן :פ×ֹ [ :Cons* :Cons ]/:0* _ ;
               ! protects against פ©ןפ×ֹ forms with %{ע£­%} (haha!)


"vowel harmony for {A} after פ©ןפ×ֹ"
%{A%}:פ¨ם <=> :פ©ן :פ×ֹ [ :Cons* :Cons ]/:0* _ ;
!         except
!             %{פ¨ך%}: %>: [ :Cons* :Cons ]/:0* _ ; 

"vowel harmony for {a} after פ¨דפ¨"
! shouldn't need a rule because it's the default פ¨׀, but doesn't seem to work without one
%{a%}:פ¨׀ <=> :פ¨ד :פ¨ [ :Cons* :Cons ]/:0* _ ;

!"Epenthesis in some stems"
!%{y%}:0 <=> _ [ :Cons :Vow ]/[ :0 | %>: ] ;
!   !@ פ¨״פ¨ב{y}פ¨ג>{A}{פ¨א}

"Delete פ¨ג after פ¨ or פ¨ב when not at the end of a word"
פ¨ג:0 <=> [ :פ¨ | :פ¨ב | :פ¨ ] _ %>:/[ :0 - %>: ] ;
:q
djfjdhf